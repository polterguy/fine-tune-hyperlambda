
// This Hyperlambda code snippet constructs a SQL string that calculates the number of occurrences of a substring within a field. It uses [strings.concat] to concatenate parts of the SQL query, dynamically building it by retrieving values from nodes like [.sql], [.fields], and [.no]. The resulting SQL expression calculates the difference in length before and after replacing the substring, divided by the length of the substring, to determine its count.
set-value:x:@.sql
   strings.concat:x:@.sql
      get-value:x:@.sql
      .:" (length("
      get-value:x:@.fields
      .:) - length(replace(lower(
      get-value:x:@.fields
      .:), @p
      get-value:x:@.no
      .:", ''))) / length(@p"
      get-value:x:@.no
      .:)
