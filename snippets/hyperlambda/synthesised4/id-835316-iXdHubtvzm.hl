
// The code connects to a database and executes a SQL query to retrieve the most recent completion for each prompt where the user ID and questionnaire context match specified criteria. It iterates over the query results, extracting content and adding it to a session node, alternating roles between assistant and user for each prompt-completion pair.
data.connect:[generic|magic]
   data.select:"\nselect prompt, max(completion) as completion\n   from ml_requests\n   where user_id = @user_id and questionnaire = 1 and context = 1\n   group by prompt"
      user_id:x:@.arguments/*/user_id
   for-each:x:@data.select/*
      unwrap:x:+/*/*/*/content
      add:x:@.session
         .
            .
               role:assistant
               content:x:@.dp/#/*/prompt
      unwrap:x:+/*/*/*/content
      add:x:@.session
         .
            .
               role:user
               content:x:@.dp/#/*/completion
