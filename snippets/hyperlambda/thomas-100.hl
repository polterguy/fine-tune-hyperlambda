/*
 * Endpoint that creates a new player account for a multiplayer game leaderboard system.
 *
 * Takes [gamer-tag] and [secret-code] as arguments.
 * If the gamer tag already exists, an error is thrown.
 * If not, the secret code is hashed with Blowfish and stored with the gamer's profile.
 */
.arguments
   gamer-tag:string
   secret-code:string
data.connect:[generic|game]
   data.read
      table:players
      where
         and
            tag.eq:x:@.arguments/*/gamer-tag
   if
      exists:x:@data.connect/*/data.read/*
      .lambda
         throw
            message:Gamer tag already in use
   crypto.password.hash:x:@.arguments/*/secret-code
   data.create
      table:players
      values
         tag:x:@.arguments/*/gamer-tag
         secret:x:@crypto.password.hash
yield
   message:Player profile created
