
// Retrieve the [user_id] from [.arguments], then execute an SQL query using [data.select] to select each unique [prompt] and the maximum [completion] from the [ml_requests] table, filtered by [user_id], [questionnaire] = 1, and [context] = 1, grouping the results by [prompt]. For each record in the result set, add two nodes to [.session]: one with [role] "assistant" and its [content] from the [prompt] field of the record, and another with [role] "user" and its [content] from the [completion] field of the record. Make sure to use [unwrap] to evaluate expressions and retrieve the correct values for [content] from the current record in the [for-each] loop.
data.connect:[generic|magic]
   data.select:"\nselect prompt, max(completion) as completion\n   from ml_requests\n   where user_id = @user_id and questionnaire = 1 and context = 1\n   group by prompt"
      user_id:x:@.arguments/*/user_id
   for-each:x:@data.select/*
      unwrap:x:+/*/*/*/content
      add:x:@.session
         .
            .
               role:assistant
               content:x:@.dp/#/*/prompt
      unwrap:x:+/*/*/*/content
      add:x:@.session
         .
            .
               role:user
               content:x:@.dp/#/*/completion
